<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <title>Montara report</title>
    <!-- Dadi - Segment loading in production -->
    <script>
      function isProduction() {
        if (localStorage.getItem("montara_analyticsForceDisable")) return false;

        return (
          (!window.location.href.includes("localhost") &&
            !window.location.href.includes("staging")) ||
          !!localStorage.getItem("montara_analyticsForceEnable")
        );
      }
      if (
        isProduction() ||
        !!localStorage.getItem("montara_analyticsForceEnable")
      ) {
        !(function () {
          var analytics = (window.analytics = window.analytics || []);
          if (!analytics.initialize)
            if (analytics.invoked)
              window.console &&
                console.error &&
                console.error("Segment snippet included twice.");
            else {
              analytics.invoked = !0;
              analytics.methods = [
                "trackSubmit",
                "trackClick",
                "trackLink",
                "trackForm",
                "pageview",
                "identify",
                "reset",
                "group",
                "track",
                "ready",
                "alias",
                "debug",
                "page",
                "once",
                "off",
                "on",
                "addSourceMiddleware",
                "addIntegrationMiddleware",
                "setAnonymousId",
                "addDestinationMiddleware",
              ];
              analytics.factory = function (e) {
                return function () {
                  var t = Array.prototype.slice.call(arguments);
                  t.unshift(e);
                  analytics.push(t);
                  return analytics;
                };
              };
              for (var e = 0; e < analytics.methods.length; e++) {
                var key = analytics.methods[e];
                analytics[key] = analytics.factory(key);
              }
              analytics.load = function (key, e) {
                var t = document.createElement("script");
                t.type = "text/javascript";
                t.async = !0;
                t.src =
                  "https://cdn.segment.com/analytics.js/v1/" +
                  key +
                  "/analytics.min.js";
                var n = document.getElementsByTagName("script")[0];
                n.parentNode.insertBefore(t, n);
                analytics._loadOptions = e;
              };
              analytics._writeKey = "sdoH0qiEHxEdygsiImGGDur17eL5vrs4";
              analytics.SNIPPET_VERSION = "4.15.3";
              analytics.load("sdoH0qiEHxEdygsiImGGDur17eL5vrs4");
              analytics.page();
            }
        })();
      }
    </script>
    <!-- End Segment -->
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
      async function fetchJSONL(url) {
        const jsonArray = [];
        const response = await fetch(url);
        const reader = response.body.getReader();
        const decoder = new TextDecoder("utf-8");
        let chunk = await reader.read();
        let result = "";

        while (!chunk.done) {
          const text = decoder.decode(chunk.value, { stream: true });
          result += text;
          const lines = result.split("\\n");
          result = lines.pop(); // In case the last chunk ends with an incomplete line
          for (const line of lines) {
            // Process each line as JSON
            try {
              const json = JSON.parse(line.trim());
              typeof json === "object" && jsonArray.push(json);
            } catch (error) {}
          }
          chunk = await reader.read();
        }

        // Process the remaining chunk
        const text = decoder.decode(chunk.value, { stream: true });
        if (text) {
          result += text;
        }
        console.log(jsonArray);
      }
      window.onload = () => {
        fetchJSONL("/montara_target/output.jsonl");
        setInterval(() => {
          fetchJSONL("/montara_target/output.jsonl");
        }, 2000);
      };
    </script>
  </body>
</html>
