<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Montara report</title>
  </head>
  <body>
    <h1>Montara report</h1>
    <script>
      async function fetchJSONL(url) {
        const jsonArray = [];
        const response = await fetch(url);
        const reader = response.body.getReader();
        const decoder = new TextDecoder("utf-8");
        let chunk = await reader.read();
        let result = "";

        while (!chunk.done) {
          const text = decoder.decode(chunk.value, { stream: true });
          result += text;
          const lines = result.split("\\n");
          result = lines.pop(); // In case the last chunk ends with an incomplete line
          for (const line of lines) {
            // Process each line as JSON
            try {
              const json = JSON.parse(line.trim());
              typeof json === "object" && jsonArray.push(json);
            } catch (error) {}
          }
          chunk = await reader.read();
        }

        // Process the remaining chunk
        const text = decoder.decode(chunk.value, { stream: true });
        if (text) {
          result += text;
        }
        console.log(jsonArray);
      }
      window.onload = () => {
        fetchJSONL("/montara_target/output.jsonl");
        setInterval(() => {
          fetchJSONL("/montara_target/output.jsonl");
        }, 2000);
      };
    </script>
  </body>
</html>
